<div class="frame">
  <header class="header">
    <button class="back-btn" onclick="history.back()">‚Üê</button>
    <div class="search-bar">
      <input type="text" id="search" placeholder="Search">
    </div>
    <div class="user-icon">üë§</div>
  </header>

  <h2 class="page-title">Add Borrowing Record</h2>
  <%= form_with(model: @borrowing, local: true, class: "add-borrowing-form") do |form| %>
    <!-- Club Selection -->
    <div class="form-row">
      <%= form.label :club_id, "Club", class: "form-label" %>
      <%= form.collection_select :club_id, @clubs, :Club_ID, :Club_Name, { prompt: "Select Club" }, { class: "form-input", id: "club-select" } %>
    </div>

    <!-- Name of Item Selection -->
    <div class="form-row">
      <%= form.label :equipment_id, "Name of Item", class: "form-label" %>
      <%= form.collection_select :equipment_id, @equipments, :id, :Equipment_Name, { prompt: "Select Equipment" }, { class: "form-input", id: "equipment-select", disabled: true } %>
    </div>

    <!-- Stock Information -->
    <div class="form-row" id="stock-container" style="display: none;">
      <small id="stock-available" class="stock-text">Stock Available: 0</small>
    </div>

    <!-- Quantity Input -->
    <div class="form-row">
      <%= form.label :quantity, "Quantity", class: "form-label" %>
      <%= form.text_field :quantity, class: "form-input", inputmode: "numeric", pattern: "[0-9]*" %>
    </div>

    <!-- Borrow Date Input -->
    <div class="form-row">
      <%= form.label :borrow_date, "Borrow Date", class: "form-label" %>
      <%= form.date_field :borrow_date, class: "form-input" %>
    </div>

    <!-- Due Date Input -->
    <div class="form-row">
      <%= form.label :due_date, "Due Date", class: "form-label" %>
      <%= form.date_field :due_date, class: "form-input" %>
    </div>

    <!-- Submit Button -->
    <div class="form-actions">
      <%= form.submit "Add Borrowing", class: "btn-submit" %>
    </div>
  <% end %>
</div>

<footer class="footer-nav">
  <button class="footer-btn">Equipment</button>
  <button class="footer-btn active">Borrow</button>
  <button class="footer-btn">Vendors</button>
</footer>

<script>
  
document.addEventListener('DOMContentLoaded', () => {
  const equipmentSelect = document.getElementById('equipment-select');
  const clubSelect = document.getElementById('club-select');
  const stockContainer = document.getElementById('stock-container');
  const stockAvailable = document.getElementById('stock-available');

  async function updateStock() {
    const equipmentId = equipmentSelect.value;
    const clubId = clubSelect.value;

    if (equipmentId && clubId) {
      // Fetch stock information dynamically
      const response = await fetch(`/equipments/${equipmentId}/club/${clubId}/stock`);
      if (response.ok) {
        const data = await response.json();
        stockAvailable.textContent = `Stock Available: ${data.stock}`;
        stockContainer.style.display = 'block';
      } else {
        stockAvailable.textContent = `Stock Available: 0`;
        stockContainer.style.display = 'block';
      }
    } else {
      stockContainer.style.display = 'none';
    }
  }

  // Enable or disable the equipment select based on club selection
  clubSelect.addEventListener('change', () => {
    if (clubSelect.value) {
      equipmentSelect.disabled = false; // Enable equipment dropdown
      updateStock(); // Update stock availability
    } else {
      equipmentSelect.disabled = true; // Disable equipment dropdown
      equipmentSelect.value = ""; // Reset equipment dropdown
      stockContainer.style.display = "none"; // Hide stock information
    }
  });

  // Trigger stock update when equipment changes
  equipmentSelect.addEventListener('change', updateStock);
});

</script>
