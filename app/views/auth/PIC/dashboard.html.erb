<%# app/views/auth/PIC/dashboard.html.erb %>
<!DOCTYPE html>
<html>
<head>
  <title>Dashboard - PIC</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
</head>

<body>
  <!-- Top Navigation -->
  <div>
    <button>
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
    </button>
    <div>
      <input type="search" placeholder="Search">
    </div>
    <button>
      <div></div>
    </button>
  </div>

  <!-- Welcome Message -->
  <h1>
    Welcome, <%= current_user.email.split('@').first %>
  </h1>

  <!-- Notifications Section -->
  <div>
  <% @notifications.each do |notification| %>
  <% borrowing = notification.borrowing %>
  <% if borrowing && borrowing.equipment %>
    <div>Reminder!</div>
    <div>
      <%= borrowing.equipment.Equipment_Name %> is overdue by 
      <%= ((Time.current - borrowing.due_date) / 1.day).to_i %> days
    </div>
  <% else %>
    <div>No associated equipment found for this borrowing.</div>
  <% end %>
<% end %>

</div>

  <!-- Latest Borrowed Section -->
  <div>
    <h2>Latest Borrowed</h2>
    <div>
      <% @borrowings.each do |borrowing| %>
        <div>
          <div>
            <div>
              <h3><%= borrowing.equipment.Equipment_Name %></h3>
              <p>
                <% days_difference = (borrowing.due_date.to_date - Date.current).to_i %>
                <% if days_difference < 0 %>
                  Overdue by: <%= days_difference.abs %> days
                <% else %>
                  Due in: <%= days_difference %> days
                <% end %>
              </p>
            </div>
            <div>
              <p>
                Borrowed on <%= borrowing.borrow_date.strftime('%d/%m/%Y') %>
              </p>
              <%= link_to "View More", borrowing_path(borrowing) %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</body>
</html>